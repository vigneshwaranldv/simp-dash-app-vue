<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Table (ES-module)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Vuetify CSS -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.5.0/dist/vuetify.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.3.67/css/materialdesignicons.min.css" rel="stylesheet">

  <!-- Import-map tells the browser where to find “vue” and “vuetify” -->
  <script type="importmap">
  {
    "imports": {
      "vue":     "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
      "vuetify": "https://cdn.jsdelivr.net/npm/vuetify@3.5.0/dist/vuetify.esm.js"
    }
  }
  </script>
</head>
<body style="margin:0">
  <div id="app"></div>

  <!-- main script (index.html) -->
  <script type="module">
    import { createApp, ref, onMounted } from 'vue';
    import { createVuetify }             from 'vuetify';
    import DynamicTable                  from './dynamic-table.js';
    import DynamicCard                   from './dynamic-card.js';
  
    const App = {
      components: { DynamicTable, DynamicCard },
  
      setup() {
        const datasets = ref([]);   // [{ label, type, rows } …]
  
        onMounted(async () => {
          try {
            /* 1. Load config */
            const cfg = await (await fetch('./configs/default.json')).json();
            const apiDefs = cfg.apis ?? [];
  
            /* 2. Fetch in parallel */
            await Promise.all(
              apiDefs.map(async ({ label, url, type = 'table' }) => {
                const rows = await (await fetch(url)).json();
                datasets.value.push({ label, type, rows });
              })
            );
          } catch (err) {
            console.error('Error loading APIs:', err);
          }
        });
  
        return { datasets };
      },
  
      template: `
        <v-app>
          <v-container>
            <template v-for="(d, i) in datasets" :key="i">
              <h2 class="text-h5 my-4">{{ d.label }}</h2>
  
              <!-- Card view: one card per item -->
              <div v-if="d.type === 'card'">
                <dynamic-card
                  v-for="(item, idx) in d.rows"
                  :key="idx"
                  :data="item"
                ></dynamic-card>
              </div>
  
              <!-- Table view -->
              <div v-else>
                <dynamic-table :items="d.rows"></dynamic-table>
              </div>
            </template>
          </v-container>
        </v-app>
      `
    };
  
    createApp(App).use(createVuetify()).mount('#app');
  </script>
  
  
  
  
  
</body>
</html>
