<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Table (ES-module)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Vuetify CSS -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.5.0/dist/vuetify.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.3.67/css/materialdesignicons.min.css" rel="stylesheet">

  <!-- Import-map tells the browser where to find “vue” and “vuetify” -->
  <script type="importmap">
  {
    "imports": {
      "vue":     "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
      "vuetify": "https://cdn.jsdelivr.net/npm/vuetify@3.5.0/dist/vuetify.esm.js"
    }
  }
  </script>
</head>
<body style="margin:0">
  <div id="app"></div>

  <!-- main script (index.html) -->
  <!-- main script -->
<script type="module">
    import { createApp, ref, onMounted } from 'vue';
    import { createVuetify }             from 'vuetify';
    import DynamicTable                  from './dynamic-table.js';
  
    const App = {
      components: { DynamicTable },
  
      setup() {
        /* each entry becomes { label, rows } */
        const tables = ref([]);
  
        onMounted(async () => {
          try {
            /* 1. Load config ------------------------------ */
            const cfgResp = await fetch('./configs/default.json');
            if (!cfgResp.ok) throw new Error(`Config fetch ${cfgResp.status}`);
            const cfg = await cfgResp.json();
  
            /* 2. Loop over every API in the config -------- */
            const apiDefs = cfg?.apis ?? [];
            const fetchPromises = apiDefs.map(async ({ label, url }) => {
              const resp = await fetch(url);
              if (!resp.ok) throw new Error(`API ${url} → ${resp.status}`);
              const data = await resp.json();
              /* push the result into tables array */
              tables.value.push({ label, rows: data });
            });
  
            /* run them all in parallel */
            await Promise.all(fetchPromises);
          } catch (err) {
            console.error(err);
          }
        });
  
        return { tables };
      },
  
      /* one table per API, with a simple heading */
      template: `
        <v-app>
          <v-container>
            <template v-for="(t, idx) in tables" :key="idx">
              <h2 class="text-h5 mb-2">{{ t.label }}</h2>
              <dynamic-table :items="t.rows" />
            </template>
          </v-container>
        </v-app>
      `
    };
  
    createApp(App)
      .use(createVuetify())
      .mount('#app');
  </script>
  
  
  
</body>
</html>
